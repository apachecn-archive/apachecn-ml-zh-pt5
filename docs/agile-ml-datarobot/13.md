# 十、推荐系统

在本章中，我们将了解什么是推荐系统，讨论它们的各种类型，并通过一个基于内容的推荐系统的 **DataRobot** 实现来工作。在本章中，**推荐系统**、**推荐系统**、**推荐引擎**和**推荐引擎**可以互换使用。

最简单的形式是，推荐系统向用户或买家推荐潜在相关的商品。在当今的商业环境中，企业倾向于销售大量的物品、产品或服务，使得用户或购买者更难联系到他们想要的产品或服务。本章解释了推荐引擎在当前商业领域的普遍性。

虽然这本书不能涵盖推荐系统的每个方面，但我们将讨论如何利用 DataRobot 来构建和(从其进行预测)推荐引擎，并给出这些系统的概念性概述，以及对其类型的简要讨论。因此，在本章结束时，您将学习如何利用 DataRobot 来构建基于内容的推荐引擎。本章的主要主题包括以下内容:

*   推荐系统的概念介绍
*   构建推荐系统的一种方法
*   在 DataRobot 中定义和设置推荐系统
*   在 DataRobot 中构建推荐系统
*   用 DataRobot 做推荐系统预测

# 技术要求

本章的大部分内容要求访问 DataRobot 软件。该代码示例基于一个相对较小的数据集 Book-Crossing，由三个表组成，其操作是用 **Jupyter Notebook** 执行的。

看看下面的视频，看看在[https://bit.ly/3HxcNUL](https://bit.ly/3HxcNUL)运行的代码。

## 跨账簿数据集

用于说明在构建推荐系统中使用 DataRobot 的示例基于 Cai-Nicolas Ziegler 及其同事的图书交叉数据集。该数据集在 http://www2.informatik.uni-freiburg.de/~cziegler/BX/的[被访问。](http://www2.informatik.uni-freiburg.de/~cziegler/BX/)

注意

在使用这个数据集之前，本书的作者已经通知了数据集的所有者关于它在本书中的使用。

Cai-Nicolas Ziegler，Sean M. McNee，Joseph A. Konstan，Georg Lausen (2005 年)。通过主题多样化改进推荐列表。第 14 届国际万维网会议论文集(WWW '05) 。2005 年 5 月 10 日至 14 日，日本千叶。

这些数据是在 2004 年 8 月至 9 月的四周购书社区收集的。接下来的三个表以 CSV 格式提供，构成了这个数据集。

*   `User-ID`表示为整数。还提供了用户的`Location`和`Age`值。
*   `ISBM`、`Book-Title`、`Book-Author`、`Year-Of-Publication`、`Publisher`。
*   `Book-Rating`值要么隐含为`0`，要么明确介于`1`和`10`之间(数字越大，评级越好)。然而，在这个项目的背景下，我们将只关注对模型开发明确的评级。该表还包括`User-ID`和`ISBN`值。

# 推荐系统的概念介绍

企业有向顾客推荐产品或服务的悠久历史。例如，走进一家书店，你很可能会看到其他顾客购买的畅销书清单。这是一种简单的推荐系统，因为它给买家一个潜在产品的快照。

为了在数字经济中取胜，企业变得越来越以客户为中心。**以客户为中心**意味着公司的目标是将客户的需求放在首位。尽管如此，由于顾客的需求和顾客本身一样多种多样，商家需要采取独特的方式来推销他们的产品。这部分解释了**基于人气的推荐系统**的失败，因为它们没有考虑到买家独特的特征。因此，随着数字化程度的提高、业务种类的增加以及客户需求的多样化，这种方法不太可能成功。

有趣的是，数据科学工具可以提供多种方法，通过以多种方式考虑买家的需求，使推荐系统更加智能。

在介绍不同类型的推荐系统时，我们将继续使用书店的例子。

首先，推荐系统的**基于项目的协同过滤**方法根据购买者的产品购买历史以及这些*产品*与其他产品的关系，向图书购买者提出产品建议。同样，如果个人购买了*图书 A* ，并且*图书 A* 与*图书 B* 关联，则建议使用*图书 B* 。第二种方法，**基于用户的协同过滤**，在提出建议时考虑*购买者*之间的相似性。这样，如果*买家 A* 与*买家 B* 相似，并且*买家 A* 购买*图书 C* ，那么*图书 C* 将推荐给*买家 B* 。第三种方法，**基于内容的推荐**，在提出建议时同时考虑图书和用户特征。最后，**混合系统**方法在推荐中使用基于协作和基于内容的方法的组合。很容易看出这两种方法各有优缺点。现在，我们将深入了解这些方法，以及如何使用 DataRobot 在系统上构建基于内容的推荐。

# 构建推荐系统的方法

推荐系统旨在向买家推荐相关的产品。由于它们能够考虑买家的独特性，智能推荐引擎已经为企业创造了数十亿美元的收入，并帮助买家找到相关产品。它们代表着消费者和企业的双赢。已经引入了各种数据驱动的方法来创建智能推荐系统。推荐系统有三种主要方法:协同过滤系统、基于内容的系统和混合系统。让我们在下面的小节中讨论每一种方法。

## 协同过滤推荐系统

协同过滤推荐系统背后的核心思想是利用他人过去的行为来推断个人可能感兴趣的内容。协作过滤方法利用产品和用户之间的历史交互的数据存储。*表 10.1* 给出了用户评分书的交互矩阵。每个用户用 1 到 5 的数字给一本书打分，5 代表最高水平的享受。如果没有评级，则认为个人没有读过这本书。有两大类协同过滤:*基于项目的*协同过滤和*基于用户的*协同过滤。

![Table 10.1 – User/product interaction matrix
](img/Figure_10.01_B17159.jpg)

表 10.1-用户/产品互动矩阵

*基于项目的协同过滤*系统(或**项目到项目的协同算法**)找到项目之间的相似性，并基于这些相似性提出建议。这种方法的基础是根据物品与这些人之前喜欢或购买的物品的相似程度向他们推荐物品。利用*表 10.1* ，基于条目的过滤方法将很容易看到*图书 C* 和*图书 E* 被之前的读者以相似的方式评级。基于这种项目关系，如果个人对*图书 C* 评价很高，则会推荐*图书 E* ，反之亦然。所以，由于*用户 5* 对*书 E* 评价很高，并且没有看过*书 C* ，所以提出了*书 C* 的推荐，因为他们喜欢*书 C* 的可能性很大。

利用*基于用户的协同过滤*系统，在*用户*之间发现相似性，并基于这些进行推荐。**用户对用户的协作算法**旨在发现具有相似行为或处于相同行为邻域的用户，如通过他们的历史行为所建立的。然后，该算法会考虑他们的偏好并提出建议。这些推荐系统的核心思想是假设如果个人*与*相似，那么*喜欢的*也会相似。从*表 10.1* 中可以推断出*用户 2* 和*用户 4* 有相似的图书兴趣。因为*用户 4* 对*图书 D* 评价很高，所以*用户 2* 喜欢*图书 D* 的可能性被认为很高，因此推荐。正如我们所见，两种协同过滤方法都基于相似性的概念。

相似性度量为推荐提供了基础。有几个相似性度量标准，其中最流行的是**皮尔逊相关系数**和**余弦相似度**。其他人已经在*邻域*上进行这种相似性测量。利用**K-最近邻**算法来分别找到与被推荐或被推荐到的项目或用户最近的项目或用户。

因为交互数据集很容易获得，所以构建协同过滤比基于内容的系统要容易得多，这将在接下来的章节中讨论。然而，推荐系统的协作方法有一些缺点。在*表 10.1* 的上下文中，引入了一个没有历史记录的新用户*用户 6* 。很容易看出，协同过滤系统将很难向这个用户进行推荐。对于没有历史数据的项目，问题是类似的。这个问题，也称为**冷启动**问题，是有据可查的。**数据稀疏**是另一个通常与协同过滤相关的问题。大多数平台和大型企业都有买家和产品。尽管如此，最活跃的用户只会购买一小部分可用产品。因此，在为这些引擎提供动力时，有意义地计算相似性所需的数据存在缺口。

## 基于内容的推荐系统

*基于内容的推荐系统*根据商品特征和用户档案提出建议。这种方法有一个不同类型的数据结构作为支撑。基于内容的系统是`1`和`5`，模型是基于回归的，因为它预测一个区间变量。这个模型成为一个基于内容的推荐引擎。

从前面的讨论中，我们可以看到，基于内容的系统可以很容易地缓解冷启动问题，因为书籍和用户可能有一些形式的描述。与协同过滤系统相比，基于内容的系统更具可扩展性，因为在生产环境中，可以在需要时轻松地进行预测，而不必同时对所有用户和产品进行预测。重要的是，即使用户只评价或购买少数产品，基于内容的系统仍然表现良好，因为它们关注的是描述，而不一定是用户或产品。也就是说，当项目的特征不容易获得时，大多数基于内容的系统都会遇到困难。在某些情况下，为产品生成属性可能会很困难(例如，如果产品是或有图像或声音)。在这种情况下，基于内容的系统将没有描述可以分析。此外，由于日益增长的在线隐私问题，用户的人口统计信息可能不容易获得。协同过滤和基于内容的推荐方法的局限性导致了混合系统的使用。

## 混合推荐系统

*混合推荐系统*是推荐系统的集成方法。混合系统通过利用两种或多种推荐策略的组合来向用户产生推荐。通过这样做，他们减轻了归因于任何一种策略的局限性，从而受益于*的众人智慧。*

混合系统有几种方法。最常用的(也是最容易实现的)是**加权方法**。这里，来自独立推荐系统的分数被合计以给出总体推荐分数。聚合方法各不相同，可以包括基本平均、应用规则和使用线性函数。**分阶段方法**也可以部署。这通常包括将推荐系统的结果作为输入特征集成到另一个推荐系统中。因此，*阶段 1* 系统的输出成为*阶段 2* 系统的附加输入。**切换方法**包括使用规则在不同的推荐系统之间切换，以在给定的上下文中利用它们的优势。例如，如果协同过滤被认为给出更好的结果，则切换机制可以使用协同过滤方法，但是当有冷启动时，它可以改变为基于内容的方法。与基于内容的系统相比，混合系统的一个优势是在难以确定项目特征时能够提出建议。正如将在第 11 章 、*使用地理空间数据、自然语言处理和图像处理*中演示的，DataRobot 具有针对图像和文本数据的高级特征提取功能。

# 在 DataRobot 中定义和设置推荐系统

DataRobot 由于其从图像、音频和文本数据中提取特征的能力，有效地管理了基于内容的推荐系统的特征可用性限制。除了 DataRobot 的自动化 ML 模型流程之外，这意味着它能够充分利用基于内容方法的优势，同时弥补这种方法的功能不可用限制。正如在*技术需求*一节中所描述的，我们示例中使用的数据集由三个表组成。这包括用户表(呈现用户的简档)、图书表(概述图书的特征)和评级表(包含用户图书评级)。因为我们有一个描述书籍的表，和另一个描述用户的表，所以整合这些表和评级就为基于内容的推荐系统奠定了基础。为此，我们使用了 Jupyter 笔记本。*图 10.1* 显示了我们接收数据集、操作数据集、合并表并将其写回 CSV 文件的脚本:

![Figure 10.1 – Data manipulations in Jupyter Notebook
](img/Figure_10.02_B17159.jpg)

图 10.1-Jupyter 笔记本中的数据操作

在评级表上`rating`的值为`0`的行被排除在外，因为评级是隐式的。在*使用 DataRobot* 进行推荐系统预测一节中，这些行将用于演示如何使用推荐引擎进行预测。通过更改标题来操作表格，并将`ratings`、`books`和`users`的值合并到一个表格中，每一行都有一个用户和一本书的描述，以及一个评级。数据快照如*表 10.2* 所示。尽管我们可以使用 Python API 方法在 Jupyter Notebook 中创建 DataRobot 项目(如第 12 章 、 *DataRobot Python API* 中所述)，但为了保持一致性，我们将数据下载为文件:`rating.csv`。

![Table 10.2 – Data snapshot
](img/Figure_10.03_B17159.jpg)

表 10.2-数据快照

按照 [*第 6 章*](B17159_06_Final_NM_ePub.xhtml#_idTextAnchor104)*中建立的流程，用 DataRobot* 建立模型，我们为推荐系统创建了一个 DataRobot 项目。当这样做时，我们将`rating.csv`文件拖入初始项目窗口。此打开图*10.2*所示的窗口。对于每一行，由于图书评级被用作用户兴趣的指标，所以它可以被用作目标变量。由于目标变量`ratings`的性质，该推荐系统的 ML 模型将是回归模型类型。

![Figure 10.2 – DataRobot project initiation window 
](img/Figure_10.04_B17159.jpg)

图 10.2–data robot 项目启动窗口

不出所料，的收视率在`1`到`10`之间。理想情况下，我们将删除带有隐式(属于`0`)评级和`user_ID`字段的行，以创建用于建模的健壮数据集。接下来要做的是建立推荐系统的 ML 模型。

# 在 DataRobot 中构建推荐系统

无人驾驶`user_id`在**群体 ID 特征**领域的优势之一。

如 [*第 6 章*](B17159_06_Final_NM_ePub.xhtml#_idTextAnchor104) 、*使用 DataRobot* 建立模型中所述，在模型创建期间，当模型**库**选项卡中的搜索字段中出现`Training Schedule`或简称为`Training`时，DataRobot 开始开发 ML 模型。这将调出相关型号列表(参见*图 10.3* ):

![Figure 10.3 – Selecting the advanced modeling approaches most suitable for recommender systems
](img/Figure_10.05_B17159.jpg)

图 10.3-选择最适合推荐系统的高级建模方法

除了选择这些建模方法将包括在要创建的模型列表中，模型`Autopilot Stage 1`基于`Informative Features`，然后进行所有五次`Cross Validation`运行。最后单击**运行任务**将这些任务包含在处理队列中。

创建模型后，下一步是评估它们的准确性。在此之前，检查**相对重要性**图来检查我们的模型是否符合常识是很重要的。从*图 10.4* 中可以明显看出，通过 **Insight** 窗口打开**变量重要性**窗口为我们提供了探索这些模型的机会:

![Figure 10.4 – Variable importance
](img/Figure_10.06_B17159.jpg)

图 10.4–可变重要性

旁边的值`London`和标题的一个方面(例如，`Kingdom`)可以被解释为对模型有影响。因此，在这个简化的例子中，创建了一个高阶特征，即`London`和`Kingdom`之间的交互。因此，根据这种新创建的高阶特征的存在，评级预测变化很大。

在型号选择中，使用确定的`Keras Slim Residual Neural Network Regressor using Adaptive Training Schedule (1 Layer: 64 Units)`是性能最好的型号(见*图 10.5* )。需要强调的是，在某些情况下，衡量推荐系统模型的准确性并不简单。想象一下，在这种情况下，当个人购买一本书时，我们只能有一个评级`1`，否则它将是`0`。天真地衡量模型的准确性变得有限，因为`0`评级并不一定意味着个人对某个项目不感兴趣。这是因为有可能这个人从未读过这本书。因为一个好的推荐系统会推荐那些其特征与一个人的简档相一致的项目，作为一个潜在的未读书籍来阅读，所以它很可能有很大比例的误报。这是因为，尽管他们目前的评级是`0`，但有问题的用户很可能会有兴趣阅读他们。在这种情况下，**召回**类型成为评估模型性能的一个更重要的指标。鉴于我们只确定个人购买物品的情况，孤立地评估这些情况是合理的。因此，模型准确性预测正确阅读的书籍的程度，通常被称为**召回**，成为更合适的度量。

![Figure 10.5 – Leaderboard tab for recommendation systems
](img/Figure_10.07_B17159.jpg)

图 10.5–推荐系统的排行榜选项卡

对于一个推荐系统，在决定使用哪个模型时，准确性和预测速度是非常重要的考虑因素。作为这个讨论的基础，重要的是理解有两种主要的方法来使用推荐系统进行预测。第一种方法是按项目对用户组合进行批量评分，其中项目还没有被用户阅读。随着项目和用户的增加，该数据集呈指数级增长。第二种方法是*实时预测*。例如，想象一个人来到一个电子商务平台。该个人的数据和产品的数据被快速评分，并且建议几乎立即被评分。在这两种情况下，预测的速度是商业成功的关键。DataRobot `Keras Slim Residual Neural Network Regressor using Adaptive Training Schedule (1 Layer: 64 Units)`为`1.6746`，其预测速度为每 1000 次预测`35.57` ms。一些 blender 模型的验证分数看起来更好，但是在预测速度方面要弱得多。

![Figure 10.6 – DataRobots' Speed vs Accuracy chart
](img/Figure_10.08_B17159.jpg)

图 10.6-DataRobot 的速度与准确度图表

这表明，尽管这个模型非常准确，但它在预测方面非常慢。**速度与准确度**图表展示了几种型号的速度和准确度的快照。可以使用**模型比较**工具进行更深入的成对比较。为了继续预测的讨论，我们现在将 tu rn 用于在 DataRobot 中进行推荐系统预测。

# 使用 DataRobot 进行推荐系统预测

从 DataRobot 上的推荐引擎创建建议非常简单。我们使用拖放方法(如前几章所述)，因为我们的预测数据集很小。对于较大的数据集(超过 1 GB)，推荐系统通常会使用 DataRobot 预测 API。创建模型和进行预测的 API 方法在 [*第 12 章*](B17159_12_Final_NM_ePub.xhtml#_idTextAnchor176) 、 *DataRobot Python API* 中有深入的介绍。

我们的预测数据集大小为 64 MB，因此拖放方法是合适的。对于这种预测方法，我们从原始数据集中指定想要使用的列。理想情况下，我们至少需要一个项目和用户的标识符。如图 10.7 中的*所示，我们已经选择将`ISBN`、`user_id`和`title`字段包含在我们的预测中。我们将预测数据集拖放到指定区域。像往常一样，这个数据集被快速评估，我们看到了**运行外部测试**或**计算预测**选项。*

![Figure 10.7 – A recommendation engine prediction setup
](img/Figure_10.09_B17159.jpg)

图 10.7-推荐引擎预测设置

此时，我们点击`.csv`文件(见*表 10.3* )。如前所述，预测集是从隐含评级的原始数据集中提取的(因此评级得分为零)。因此，预测数据集仅具有可能的人-项目交互的有限样本。一些用户(例如，`8`为`user_id`的用户)有大约`10`项得分，而一些用户只有`1`项得分。在理想情况下，个人看不到的所有项目都将被评级。也就是说，提供给用户的建议是按照预测兴趣的顺序进行的。对于用户`8`，首先提供标题为`A Second Chicken Soup for the Woman's Soul (Chicken Soup for the Soul Series)`的图书。在某些情况下，会使用 top *n* 建议。在我们的图书案例中，前 *n* 是指，对于每个用户，前 *n* 本书是根据他们的预测值选择的。

![ Table 10.3 – A recommendation engine sample prediction
](img/Figure_10.10_B17159.jpg)

表 10.3-推荐引擎样本预测

使用 DataRobot 可以将选中的模型部署为 **REST** API，如 [*第八章*](B17159_08_Final_NM_ePub.xhtml#_idTextAnchor116) 、*模型评分和部署*所示，然后可以通过 DataRobot API 调用对数据进行评分(我们将在 [*第十二章*](B17159_12_Final_NM_ePub.xhtml#_idTextAnchor176) 、 *DataRobot Python API* 中讨论)。一些 DataRobot 模型可以作为 **JAR** 文件下载，这些文件可以与其他应用集成以进行实时预测。在其他地方，可以使用不同的人-项目交互进行批量预测，然后将存储在大数据存储表中，如**谷歌云 BigQuery** 。

# 总结

在这一章中，我们介绍并评价了推荐系统的不同方法。我们研究了基于内容和协同过滤推荐系统的数据结构要求，并讨论了它们的基本假设。然后，我们指出 DataRobot 在从具有挑战性的数据类型(例如，图像数据)中提取特征方面的优势，这些数据类型通常会限制基于内容的系统的使用。然后，我们举例说明了 DataRobot 在使用一个基于小数据集的基于内容的推荐系统来构建和做出预测方面的用途。

需要强调的是，这个项目使用的数据集由多种数据类型组成。DataRobot 能够提取特征并集成不同的数据类型来创建 ML 模型。在下一章中，我们将探讨在创建 ML 模型时，如何将数据集与图像、文本和位置数据结合使用。