<html><head/><body>





<style type="text/css">body{margin:1em;background-color:transparent!important;}#sbo-rt-content *{text-indent:0pt!important;}#sbo-rt-content .bq{margin-right:1em!important;}</style>
<div><div><h1 id="_idParaDest-84"><em class="italic"> <a id="_idTextAnchor084"/>第六章</em>:视觉模型培训与发布</h1>
			<p><strong class="bold">Azure Machine Learning</strong>(<strong class="bold">Azure ml</strong>)Studio 通过允许你拖放和配置训练和推理管道，在开发模型时提供设计师体验。在本章中，您将对设计器有一个概述。然后，您将创建一个培训流程。一旦您看到了与设计器一起使用的整个流程，我们将通过创建一个推理管道并发布经过训练的模型工件作为服务端点来结束本章。</p>
			<p>在本章中，我们将讨论以下主题:</p>
			<ul>
				<li>设计器概述</li>
				<li>设计培训流程</li>
				<li>创建批处理和实时推理管道</li>
				<li>部署实时推理管道</li>
			</ul>
			<h1 id="_idParaDest-85"><a id="_idTextAnchor085"/>技术要求</h1>
			<p>您需要访问 Azure 订阅。在该订阅中，您将需要一个<code>packt-azureml-rg</code>。此外，你将需要一个<code>Contributor</code>或<code>Owner</code>T3，如<a href="B16777_02_Final_VK_ePub.xhtml#_idTextAnchor026"> <em class="italic">第 2 章</em> </a>、<em class="italic">部署 Azure 机器学习工作区资源</em>中所述。</p>
			<p>您还需要在您的工作空间中注册<code>churn-dataset</code>，这是您在<a href="B16777_05_Final_VK_ePub.xhtml#_idTextAnchor072"> <em class="italic">第 5 章</em> </a>，<em class="italic">中创建的，让机器进行模型训练</em>。</p>
			<h1 id="_idParaDest-86"><a id="_idTextAnchor086"/>设计者概述</h1>
			<p>AzureML <a id="_idIndexMarker410"/> Studio <a id="_idIndexMarker411"/>提供了一个图形设计器，允许你可视化地创作管道。根据定义，流水线是描述机器学习任务的独立的<a id="_idIndexMarker412"/>可执行子任务流。您可以在设计器中创建三种类型的管道:</p>
			<ul>
				<li><strong class="bold">训练管道</strong>:这些<a id="_idIndexMarker414"/>管道用于训练模型。</li>
				<li><strong class="bold">批量推理管道</strong>:这些<a id="_idIndexMarker415"/>管道用于操作批量预测的预训练模型。</li>
				<li><strong class="bold">实时推理管道</strong>:这些管道用于公开一个 REST API，允许<a id="_idIndexMarker416"/>第三方应用使用预先训练好的模型进行实时预测。</li>
			</ul>
			<p>要创建批处理和实时管道，您需要创建一个训练管道。在接下来的小节中，您将学习如何创建一个训练管道，然后在此基础上生成一个批处理和实时管道。在<a href="B16777_11_Final_VK_ePub.xhtml#_idTextAnchor160"> <em class="italic">第十一章</em> </a>、<em class="italic">使用管道</em>中，你将学习如何通过代码创作类似的管道。</p>
			<p>要开始创作管道，您需要访问<strong class="bold"> Designer </strong>主页。点击<strong class="bold">设计师</strong>菜单项，导航至首页，如下截图所示:</p>
			<div><div><img src="img/B16777_06_001.jpg" alt="Figure 6.1 – Designer home page&#13;&#10;" width="449" height="481"/>
				</div>
			</div>
			<p class="figure-caption">图 6.1–设计者主页</p>
			<p>在<strong class="bold"> New pipeline + </strong>按钮旁边，您会看到其他几个按钮，它们带有不同的现成样本管道。请<a id="_idIndexMarker417"/>稍后熟悉这些样品。这些示例会定期更新以显示设计器的最新功能，这是一个很好的入门资源。</p>
			<p>在本章中，我们将从头开始创建一个新的管道。点击<strong class="bold"> + </strong>按钮会将您带到创作屏幕/视图，我们将在下一节中探讨。</p>
			<h2 id="_idParaDest-87"><a id="_idTextAnchor087"/>创作屏幕/视图</h2>
			<p>与设计者一起建造管道的<a id="_idIndexMarker418"/>主页看起来<a id="_idIndexMarker419"/>如下:</p>
			<div><div><img src="img/B16777_06_002.jpg" alt="Figure 6.2 – AzureML designer authoring view&#13;&#10;" width="1650" height="1086"/>
				</div>
			</div>
			<p class="figure-caption">图 6.2–azure ml 设计器创作视图</p>
			<p>这里我们将描述<a id="_idIndexMarker420"/>主页面用户界面，前面的<a id="_idIndexMarker421"/>截图作为参考:</p>
			<ul>
				<li>通过点击左上角的汉堡图标(<img src="img/1.png" alt="" width="46" height="33"/>)，你可以隐藏和取消隐藏前面截图中显示为编号<strong class="bold"> 1 </strong>的 AzureML 主菜单。从现在开始，我们假设这个区域是隐藏的。</li>
				<li>在标记为数字<strong class="bold"> 2 </strong>的区域中，您可以找到可以放到画布上的所有资产，在前面的截图中称为数字<strong class="bold"> 3 </strong>。通过将不同的资产放到画布上，您可以构建一个管道。在本章的<em class="italic">了解资产库</em>一节中，你会学到更多关于这方面的知识。</li>
				<li>在标记为<strong class="bold"> 4 </strong>的右侧区域，您将找到设置。该区域也称为详细信息页面。此视图会根据您在画布中选择的内容而变化。如果您没有在画布区域选择任何资产，您将看到您正在构建的管道的设置，并且您可以选择一个<strong class="bold">默认计算目标</strong>，它将运行每个管道步骤。如果您选择一项资产，您会发现该特定资产的各种配置选项。</li>
				<li>面积<code>test-pipeline</code>。</li>
				<li>在<strong class="bold"> 5 </strong>区，你<a id="_idIndexMarker422"/>还会找到<strong class="bold">设置</strong>按钮(<img src="img/2.png" alt="" width="33" height="36"/>)。使用该按钮，您可以隐藏/取消隐藏前面截图中标记为<strong class="bold"> 4 </strong>的<strong class="bold">设置</strong>区域。在同一区域，您可以找到其他图标，允许您在画布上保存或删除管道和<strong class="bold">撤销、重做和搜索</strong>、T12】和。<strong class="bold">选择</strong>工具(<img src="img/3.png" alt="" width="47" height="46"/>)是画布上的标准光标。稍后，当我们在管道上工作时，我们将切换到<strong class="bold">手</strong>工具(<img src="img/4.png" alt="" width="46" height="48"/>)来移动画布上的选定部分。点击<strong class="bold">设置</strong>隐藏区域<strong class="bold"> 4 </strong>并增加画布的大小。</li>
				<li>最后一个<a id="_idIndexMarker423"/>区域，在前面的截图中标记为<strong class="bold"> 6 </strong>，为您提供了<strong class="bold">提交、发布和 c</strong>T5 独立管道的功能，我们将在<em class="italic">创建批处理和实时推理管道</em>一节中讨论。</li>
			</ul>
			<p>在进入下一部分之前，您需要配置管道用来执行所有步骤的默认计算目标属性。打开管道设置，选择你在第五章<a href="B16777_05_Final_VK_ePub.xhtml#_idTextAnchor072"><em class="italic"/></a><em class="italic">中使用的计算集群，让机器做模型训练</em>。</p>
			<p>在下一部分中，您将探索标记为<strong class="bold"> 2 </strong>的区域，也称为<em class="italic">资源库</em>。</p>
			<h2 id="_idParaDest-88"><a id="_idTextAnchor088"/>了解资产库</h2>
			<p>为了建立一个<a id="_idIndexMarker424"/>管道，你需要将<a id="_idIndexMarker425"/>各种资产缝合在一起。在本节中，您将看到设计器的资源库中可用的不同资源。在<em class="italic">图 6.2 </em>中，我们有 96 个可用。这个数字取决于您在 AzureML 工作空间中注册了多少数据集，在 AzureML 的未来版本中，您甚至可以创建自己的编码资产。下图显示了资产库中可用的类别，并简要说明了它们包含的资产类型(也称为模块):</p>
			<div><div><img src="img/B16777_06_003.jpg" alt="Figure 6.3 – Categories in the AzureML designer asset library&#13;&#10;" width="1646" height="1073"/>
				</div>
			</div>
			<p class="figure-caption">图 6.3–azure ml 设计器资产库中的类别</p>
			<p>该库中有三种类型的资产:</p>
			<ul>
				<li>用于手动输入的数据集和模块</li>
				<li>未经训练的模型</li>
				<li>对数据执行特定操作的模块</li>
			</ul>
			<p>在 designer 中构建您的第一个端到端机器学习培训管道时，您将从此资源库中拖放组件。在下一节中，您将看到每个资产的样子，以及如何在它们之间连接各种资产。</p>
			<h2 id="_idParaDest-89"><a id="_idTextAnchor089"/>探索资产的输入和输出</h2>
			<p>我们从资产库中删除的每个资产都是我们正在构建的管道中的一个模块。一个模块看起来类似于下面截图中所示的示例<a id="_idIndexMarker429"/>模块:</p>
			<div><div><img src="img/B16777_06_004.jpg" alt="Figure 6.4 – A sample module with two inputs and one output&#13;&#10;" width="438" height="179"/>
				</div>
			</div>
			<p class="figure-caption">图 6.4-具有两个输入和一个输出的样本模块</p>
			<p>让我们从上到下描述一下这个模块:</p>
			<ul>
				<li>顶部有零个、一个或多个输入端口:前面截图中的示例模块接受两个输入。您可以将另一个模块的输出连接到下一个模块的输入。</li>
				<li>在模块的中间，名称描述了模块的功能。我们的例子是一个<strong class="bold">训练模型</strong>模块，它用右输入端口给定的数据训练一个在左输入端口传入的未训练模型。</li>
				<li>如果在画布中选择该模块，该模块的详细页面将出现在<em class="italic">图 6.2 </em>中标为<strong class="bold"> 4 </strong>的区域。每个模块的页面都不同。您可以配置各种选项，例如它的简短描述或者将执行特定模块的计算目标。</li>
				<li>在模块名称下，您可以阅读该模块的描述文本。您可以通过选择模块并编辑模块详细信息页面上的文本来编辑此描述。我们示例中的模块描述显示了文本<strong class="bold">示例模块</strong>。</li>
				<li>在模块的底部，有一个或多个<strong class="bold">输出端口</strong>，你可以拖动并连接到下一个模块。</li>
			</ul>
			<p>在本节中，您<a id="_idIndexMarker430"/>探索了 AzureML Studio 设计器的各个方面。在下一部分，您将开始<a id="_idIndexMarker431"/>创作您的第一个培训管道。</p>
			<h1 id="_idParaDest-90"><a id="_idTextAnchor090"/>与设计师一起建造管道</h1>
			<p>在本节中，我们<a id="_idIndexMarker432"/>将创建一个训练管道，根据您在上一章中使用的<strong class="bold">变动</strong>数据集来训练<a id="_idIndexMarker433"/>一个机器学习模型。</p>
			<p>当您开始设计培训管道时，我们建议利用下图所示的机器学习的<em class="italic"> 7 个步骤</em>方法，其中包含创建机器学习模型所需的所有步骤:</p>
			<div><div><img src="img/B16777_06_005.jpg" alt="Figure 6.5 – 7 Steps of Machine Learning&#13;&#10;" width="1035" height="579"/>
				</div>
			</div>
			<p class="figure-caption">图 6.5–机器学习的 7 个步骤</p>
			<p>这个 7 步之旅是真实端到端场景的宝贵清单，可确保您不会遗漏任何东西。在这个旅程中，您将需要各种组件、转换和模型，这些都可以在资源库中找到。为了简单起见，我们将跳过您将要设计的管道中的几个步骤。在本节中，您将从准备用来训练模型的数据集开始。然后，您将评估模型并存储它。在下一节中，您将使用该模型创建一个批处理和一个利用该模型进行预测的<a id="_idIndexMarker434"/>实时管道。</p>
			<p>让我们从获取将用于训练模型的数据开始，这是您将在下一节中做的事情。</p>
			<h2 id="_idParaDest-91"><a id="_idTextAnchor091"/>获取数据</h2>
			<p>第一步<a id="_idIndexMarker436"/>是选择将用于训练模型的数据集:</p>
			<ol>
				<li>In the asset library, expand the <strong class="bold">Datasets</strong> category by clicking on the arrow next to its name. You should see <strong class="bold">churn-dataset</strong> there, which you created in <a href="B16777_05_Final_VK_ePub.xhtml#_idTextAnchor072"><em class="italic">Chapter 5</em></a>, <em class="italic">Letting the Machines Do the Model Training</em>:<div><img src="img/B16777_06_006.jpg" alt="Figure 6.6 – churn-dataset under the Datasets category&#13;&#10;" width="443" height="144"/></div><p class="figure-caption">图 6.6-数据集类别下的流失数据集</p></li>
				<li>Drag <strong class="bold">churn-dataset</strong> onto the canvas:<div><img src="img/B16777_06_007.jpg" alt="Figure 6.7 – Canvas with churn-dataset&#13;&#10;" width="1296" height="1241"/></div><p class="figure-caption">图 6.7–带有流失数据集的画布</p><p>这样，您就完成了<strong class="bold">数据收集</strong>步骤，这意味着您可以继续进行机器学习<em class="italic"> 7 个步骤中的第 2 步</em>。</p></li>
				<li><a id="_idIndexMarker437"/>下一步是<strong class="bold">数据准备</strong>。通过将数据集模块中的<strong class="bold">选择列(可以在资产库中的<strong class="bold">数据转换</strong>类别下找到)拖到画布上，向管道添加一个处理步骤。</strong></li>
				<li>You will now need to create a flow between the dataset and the module. You can do that by pulling from the dataset's <strong class="bold">output port</strong>, the small circle at the bottom of this <strong class="bold">dataset</strong>, to the dataset's <strong class="bold">input port</strong>, the small circle at the top of the <strong class="bold">Select Columns in Dataset</strong> module, as shown in the following screenshot:<div><img src="img/B16777_06_008.jpg" alt="Figure 6.8 – Creating a flow between the dataset and the processing module&#13;&#10;" width="1311" height="660"/></div><p class="figure-caption">图 6.8–在数据集和处理模块之间创建流程</p></li>
				<li>下一步是配置数据集模块中的<strong class="bold">选择列。在画布中选择模块后，单击细节窗格上的<strong class="bold">编辑列</strong>链接，细节窗格位于画布的右侧，如前面的屏幕截图所示。将出现<strong class="bold">选择列</strong>对话框。请参见下面的屏幕截图，了解该弹出窗口的最终配置。</strong></li>
				<li>在弹出菜单中，从下拉菜单中选择所有列。</li>
				<li>点击<strong class="bold"> + </strong>按钮添加第二行。</li>
				<li>从下拉列表中选择<strong class="bold">排除</strong>。</li>
				<li>从第二个下拉菜单中选择<strong class="bold">列名</strong>。</li>
				<li>Select the <strong class="bold">id</strong> column from the last dropdown.<p>对话框页面应该如下所示:</p><div><img src="img/B16777_06_009.jpg" alt="Figure 6.9 – Select columns dialog&#13;&#10;" width="1140" height="475"/></div><p class="figure-caption"> </p><p class="figure-caption">图 6.9–选择列对话框</p></li>
				<li>点击<strong class="bold">保存</strong>关闭弹出窗口。</li>
			</ol>
			<p>到目前为止，您已经<a id="_idIndexMarker439"/>选择了将用于训练模型的数据集，并且您已经通过删除<strong class="bold"> id </strong>列准备了数据，这在训练过程中是不需要的。在下一部分中，您将通过添加未训练模型、将训练模型的模块以及用于对已训练模型进行评分和评估的模块来最终确定您的训练管道。</p>
			<h2 id="_idParaDest-92"><a id="_idTextAnchor092"/>准备数据和训练模型</h2>
			<p>现在，你将<a id="_idIndexMarker440"/>选择你要训练的模型。在<a href="B16777_05_Final_VK_ePub.xhtml#_idTextAnchor072"> <em class="italic">第五章</em> </a>，<em class="italic">让机器做模型训练</em>中，你确定了一个<strong class="bold">投票组合</strong>作为给定数据的最佳表现模型。这类模型是不同模型的<a id="_idIndexMarker441"/>组合，包括<strong class="bold">随机森林</strong>。为了使这个例子简单，您将使用一个<strong class="bold">两类决策森林</strong>模型，类似于<strong class="bold">随机森林</strong>。让我们开始吧:</p>
			<ol>
				<li value="1">导航到资源库中的<strong class="bold">机器学习算法</strong>类别。你会注意到几个子类，包括<strong class="bold">分类</strong>。从该子类别中，将<strong class="bold">两类决策森林</strong>模块拖放到画布上。</li>
				<li>对于<a id="_idIndexMarker442"/>模型训练，您将需要两个额外的模块:可以在<strong class="bold">数据转换</strong>类别下的资源库中找到的<strong class="bold">分割数据</strong>模块，以及可以在<strong class="bold">模型训练</strong>类别中找到的<strong class="bold">训练模型</strong>模块。将两个模块拖放到画布上。</li>
				<li>您需要扩展在上一节中创建的数据流，以便通过新模块传递数据。将数据集模块中<strong class="bold">选择列的<strong class="bold">输出端口</strong>拉到<strong class="bold">拆分数据</strong>模块的<strong class="bold">输入端口</strong>。</strong></li>
				<li>您需要在模块的细节窗格中配置<strong class="bold">分割数据</strong>模块，如下面的屏幕截图所示。将第一个输出数据集中的<strong class="bold">行的分数</strong>设置为<strong class="bold"> 0.7 </strong>。通过这样做，70%的数据将被发送到用于训练模型的<strong class="bold">左输出端口</strong>区域，30%将被发送到用于测试的<strong class="bold">右输出端口</strong>区域。</li>
				<li><strong class="bold">列车模型</strong>模块接受两个输入。在<strong class="bold">左输入端口</strong>区域，您需要通过一个未经训练的模型，该模型将用<strong class="bold">右输入端口</strong>区域给出的数据进行训练。将<strong class="bold">两级决策森林</strong>模块的一个<strong class="bold">输出端口</strong>拉到<strong class="bold">列车模型</strong>模块的<strong class="bold">左输入端口</strong>区域。</li>
				<li>Drag the <strong class="bold">left output port</strong> area of the <strong class="bold">Split Data</strong> module to the <strong class="bold">right input port</strong> area of <strong class="bold">Train Model</strong>. Your canvas should look as follows:<div><img src="img/B16777_06_010.jpg" alt="Figure 6.10 – The Train Model module is missing some configuration&#13;&#10;" width="1440" height="1125"/></div><p class="figure-caption">图 6.10–列车模型模块缺少一些配置</p></li>
				<li>In the <a id="_idIndexMarker444"/>preceding screenshot, there is an orange exclamation mark in the <strong class="bold">Train Model</strong> module. This mark indicates that something is misconfigured in that module. So far, you have configured <a id="_idIndexMarker445"/>which model to train and what data to use for the model's training. However, you have not defined which column the model should predict yet. This column is referred to as <strong class="bold">Label column</strong>. To configure <strong class="bold">Label column</strong>, select the module in the canvas and click on the <strong class="bold">Edit column</strong> link. This will open the <strong class="bold">Label column</strong> dialog shown in the following screenshot. Select the <strong class="bold">churned</strong> column from the drop-down list and click <strong class="bold">Save</strong>:<div><img src="img/B16777_06_011.jpg" alt="Figure 6.11 – Selecting the column that the model will predict&#13;&#10;" width="746" height="182"/></div><p class="figure-caption">图 6.11–选择模型将预测的列</p><p>到目前为止，训练管道正在执行机器学习的<em class="italic"> 7 步中的前 4 步。下一步是评估模型。</em></p></li>
				<li>拖拽<strong class="bold">评分模型</strong>模块<a id="_idIndexMarker447"/>到画布上，可以在<strong class="bold">模型评分&amp;评估</strong>类别下的资源库中找到。该模块接受在<strong class="bold">左输入端口</strong>区域的训练模型和在<strong class="bold">右输入端口</strong>区域的数据集。此模块的输出是一个数据集，其中包含模型针对传入数据集做出的推理。</li>
				<li>将<strong class="bold">分割数据</strong>模块的<strong class="bold">右输出端口</strong>区连接到<strong class="bold">评分模型</strong>模块的<strong class="bold">右输入端口</strong>区。这将创建一个数据流，将原始数据的 30%部分带入<strong class="bold">评分模型</strong>模块。</li>
				<li>将<strong class="bold">列车模型</strong>模块的<strong class="bold">输出端口</strong>区连接到<strong class="bold">乐谱模型</strong>模块的<strong class="bold">左输入端口</strong>区。<strong class="bold">评分模型</strong>模块将使用训练好的模型对输入数据进行推理。</li>
				<li>拖动<a id="_idIndexMarker448"/>并将<strong class="bold">评估模型</strong>模块放到画布上，该模块可以在<strong class="bold">模型评分&amp;评估</strong>类别下的资源库<a id="_idIndexMarker449"/>中找到。该模块将模型所做的预测与存储在<strong class="bold">搅动</strong>列中的值进行比较。</li>
				<li>Connect the <strong class="bold">output port</strong> area of the <strong class="bold">Score Model</strong> module to the <strong class="bold">left input port</strong> area of the <strong class="bold">Evaluate Model</strong> module.<p>如果到目前为止您已经完成了所有步骤，那么您的画布应该如下所示:</p><div><img src="img/B16777_06_012.jpg" alt="Figure 6.12 – The completed training pipeline&#13;&#10;" width="1535" height="1272"/></div></li>
			</ol>
			<p class="figure-caption"> </p>
			<p class="figure-caption">图 6.12-完整的培训管道</p>
			<p>到目前为止，您已经创建了一个执行以下操作的培训管道:</p>
			<ul>
				<li>从数据集中删除 id 为的<strong class="bold">列。</strong></li>
				<li>将<a id="_idIndexMarker450"/>数据分成训练数据集和验证数据集。训练数据集包含 70%的原始数据。验证数据集包含剩余的 30%。</li>
				<li>使用训练数据集训练<strong class="bold">两类决策森林</strong>。</li>
				<li>使用训练好的模型对<a id="_idIndexMarker451"/>验证数据集进行评分。</li>
				<li>通过检查评分数据集中的结果来评估模型的性能。您将能够在<strong class="bold">评估模型</strong>模块中查看已训练模型的指标。</li>
			</ul>
			<p>在下一部分中，您将执行此管道来训练模型。</p>
			<h2 id="_idParaDest-93"><a id="_idTextAnchor093"/>执行培训管道</h2>
			<p>在前面的<a id="_idIndexMarker452"/>部分中，您创建了一个完整的培训管道，现在您将通过创建一个新的管道运行来执行它。让我们开始吧:</p>
			<ol>
				<li value="1">点击右上角的<strong class="bold">提交</strong>按钮。将打开<strong class="bold">设置管道运行</strong>对话框，如下图所示。</li>
				<li>您需要创建一个新的实验，并将其命名为<strong class="bold"> test-pipeline </strong>。选择<strong class="bold">创建新的</strong>单选按钮，然后输入这个名字。</li>
				<li>注意，管道将在您在<em class="italic">创作屏幕/视图</em>部分选择的默认<strong class="bold">计算目标</strong>中执行。点击<strong class="bold">提交</strong>按钮，开始执行培训管道:</li>
			</ol>
			<div><div><img src="img/B16777_06_013.jpg" alt="Figure 6.13 – Preparing to execute the training pipeline&#13;&#10;" width="682" height="664"/>
				</div>
			</div>
			<p class="figure-caption">图 6.13-准备执行培训管道</p>
			<p>一旦<a id="_idIndexMarker453"/>管道完成执行，设计器将看起来如下所示:</p>
			<p class="figure-caption"> </p>
			<div><div><img src="img/B16777_06_014.jpg" alt="Figure 6.14 – Successfully running the pipeline&#13;&#10;" width="1650" height="965"/>
				</div>
			</div>
			<p class="figure-caption">图 6.14–成功运行管道</p>
			<p>至此，您已经成功完成了第一条管道的开发和培训。当流水线执行完成后，会出现<strong class="bold">创建推理流水线</strong>按钮。下一节描述了创建推理管道时的不同选项。</p>
			<h1 id="_idParaDest-94"><a id="_idTextAnchor094"/>创建批处理和实时推理管道</h1>
			<p>本节<a id="_idIndexMarker455"/>将讨论从设计者部署推理管道的两个选项:<strong class="bold">批处理</strong>和<strong class="bold">实时</strong>:</p>
			<ul>
				<li>通过批量预测，您可以对大型数据集进行异步评分。</li>
				<li>使用实时预测，您可以对一个小数据集或单行进行实时评分。</li>
			</ul>
			<p>当您创建一个<a id="_idIndexMarker456"/>推理管道时，无论是批处理还是实时的，AzureML 都会处理以下事情:</p>
			<ul>
				<li>AzureML 将经过训练的模型和所有经过训练的数据处理模块作为资产存储在资产库中的<strong class="bold">数据集</strong>类别下。</li>
				<li>它自动删除不必要的模块，如<strong class="bold">火车模型</strong>和<strong class="bold">分割数据</strong>。</li>
				<li>它将训练好的模型添加到管道中。</li>
			</ul>
			<p>特别是<a id="_idIndexMarker457"/>对于实时推理管道，AzureML 会在最终管道中增加一个<strong class="bold"> web 服务输入</strong>和一个<strong class="bold"> web 服务输出</strong>。</p>
			<p>让我们从创建批处理管道开始，这是您将在下一节中做的事情。</p>
			<h2 id="_idParaDest-95"><a id="_idTextAnchor095"/>创建批处理管道</h2>
			<p>在这个<a id="_idIndexMarker458"/>部分，您将创建一个批处理推理管道。让我们开始吧:</p>
			<ol>
				<li value="1">Click on the <strong class="bold">Create inference pipeline</strong> dropdown next to the <strong class="bold">Submit</strong> button and select <strong class="bold">Batch inference pipeline</strong>. This action will create the <strong class="bold">Batch inference pipeline</strong> tab, as shown in the following screenshot:<div><img src="img/B16777_06_015.jpg" alt="Figure 6.15 – The Batch inference pipeline tab showing the default generated pipeline&#13;&#10;" width="1582" height="1087"/></div><p class="figure-caption">图 6.15–显示默认生成管道的批处理推理管道选项卡</p></li>
				<li>通过添加管道参数，您将能够在运行时更改管道的行为。在我们的例子中，我们希望参数化使用哪个数据集来进行预测。要对输入数据集进行参数化，点击<strong class="bold"> churn-dataset </strong>并在右侧的细节窗格中选择<strong class="bold"> Set as pipeline parameter </strong>复选框。</li>
				<li>将<strong class="bold">参数名</strong>文本框中的<a id="_idIndexMarker459"/>默认参数名改为<strong class="bold">批处理文件</strong>。</li>
				<li>点击<strong class="bold">发布</strong>按钮，弹出<strong class="bold">设置发布管道</strong>对话框，如下图所示。</li>
				<li>选择<strong class="bold">创建新的</strong>单选按钮来定义一个新的管道端点。此端点用于触发您将要发布的管道。</li>
				<li>保持<strong class="bold">新管线端点名称</strong>字段的默认值不变。应该是<strong class="bold">测试流水线批量推理</strong>。</li>
				<li>通过填写<strong class="bold"> PipelineEndpoint description(可选)</strong>字段，您可以向发布的端点添加描述。在该字段中编写名为 batchfile 批处理流水线参数的<strong class="bold">测试。</strong></li>
				<li>Keep all the other settings as is. The completed dialog page should look as follows:<div><img src="img/B16777_06_016.jpg" alt="Figure 6.16 – Published pipeline dialog page&#13;&#10;" width="444" height="503"/></div><p class="figure-caption">图 6.16-已发布的管道对话框页面</p></li>
				<li>Click on the <strong class="bold">Publish</strong> button.<p>一旦成功发布了<a id="_idIndexMarker460"/>管道的端点，下面截图中显示的消息将出现在设计器中。<strong class="bold">测试-管道-批量推理</strong>链接将引导您到发布的管道:</p></li>
			</ol>
			<div><div><img src="img/B16777_06_017.jpg" alt="" width="653" height="47"/>
				</div>
			</div>
			<p class="figure-caption">图 6.17–发布成功</p>
			<p>现在您已经发布了一个批处理推理管道，您可以通过 AzureML Studio 接口来触发它。在<a href="B16777_11_Final_VK_ePub.xhtml#_idTextAnchor160"> <em class="italic">第 11 章</em> </a>、<em class="italic">使用管道</em>中，在<em class="italic">发布管道以将其公开为端点</em>一节中，您将了解更多关于这些管道的信息，以及如何<a id="_idIndexMarker461"/>将它们与第三方应用程序集成。</p>
			<p>在下一节中，我们将基于训练管道创建一个实时管道。</p>
			<h2 id="_idParaDest-96"><a id="_idTextAnchor096"/>创建实时管道</h2>
			<p>在本节中，您<a id="_idIndexMarker462"/>将创建一个实时推理管道。让我们开始吧:</p>
			<ol>
				<li value="1">在设计器中选择<strong class="bold">培训管道</strong>页签，在<em class="italic">图 6.15 </em>左上角可见。</li>
				<li>Click on the <strong class="bold">Create inference pipeline</strong> dropdown next to the <strong class="bold">Submit</strong> button and select <strong class="bold">Real-time inference pipeline</strong>. This will generate the default <strong class="bold">r</strong><strong class="bold">eal-time inference pipeline</strong> shown in the following screenshot:<div><img src="img/B16777_06_018.jpg" alt="Figure 6.18 – The default real-time inference pipeline&#13;&#10;" width="1295" height="922"/></div><p class="figure-caption">图 6.18–默认实时推理管道</p><p>在我们部署这个管道之前，我们需要做一些更改。</p></li>
				<li>点击数据集模块中的<strong class="bold">选择列，并点击右侧细节窗格中的<strong class="bold">编辑列</strong>链接。</strong></li>
				<li>点击加号(<strong class="bold"> + </strong>)图标，向<strong class="bold">选择列</strong>对话框添加一个<a id="_idIndexMarker463"/>新行。</li>
				<li>Select <strong class="bold">Exclude</strong> and <strong class="bold">Column names</strong> from the corresponding dropdowns and enter <strong class="bold">churned</strong> as the column's name to exclude. The dialog page should look as follows:<div><img src="img/B16777_06_019.jpg" alt="Figure 6.19 – Excluding both the id and churned columns from the incoming dataset&#13;&#10;" width="1119" height="542"/></div><p class="figure-caption">图 6.19–从传入的数据集中排除 id 和 churned 列</p></li>
				<li>从资产库中的<strong class="bold">数据转换</strong>类别中，将<strong class="bold">应用 SQL 转换</strong>模块拖到画布上。将其放置在<strong class="bold"> Webservice 输出</strong>模块的上方。</li>
				<li>将<strong class="bold">评分模型</strong>模块的<strong class="bold">输出端口</strong>区连接到<strong class="bold">应用 SQL 转换</strong>模块的<strong class="bold">左输入端口</strong>区。</li>
				<li>删除<strong class="bold">评分模型</strong>模块和<strong class="bold"> Web 服务输出</strong>模型之间的连接。为此，通过单击选择这两个模块之间的连接。高亮显示时，选择回收站图标或按键盘上的<em class="italic">删除</em>按钮。应该拆下连接器。</li>
				<li>从画布中删除<strong class="bold">评估模型</strong>模块<a id="_idIndexMarker464"/>。</li>
				<li>将<strong class="bold">应用 SQL 转换</strong>模块的<strong class="bold">输出端口</strong>区域连接到<strong class="bold"> Web 服务输出</strong>模块的<strong class="bold">输入端口</strong>区域。</li>
				<li>选择<strong class="bold">应用 SQL 转换</strong>模块。</li>
				<li>Click on the <strong class="bold">Edit code</strong> link in the <strong class="bold">Apply SQL Transformation</strong> detail pane and replace the default query with the following one:<pre>select [Scored Labels] from t1</pre><p>该 SQL 转换仅选择预测值，该值存储在<strong class="bold">得分标签</strong>列中。</p></li>
				<li>按下<strong class="bold">保存</strong>按钮。更改后的管道应该如下图所示。</li>
				<li>为了确保您设计的管道正确执行，您需要使用<strong class="bold">提交</strong>按钮运行一次。将出现<strong class="bold">设置发布管道</strong>对话框。</li>
				<li>您将需要在一个实验中执行管道。选择<strong class="bold">创建新的</strong>单选按钮。</li>
				<li>使用<strong class="bold">测试流水线实时推理</strong>作为<strong class="bold">新的实验名称</strong>。</li>
				<li>Keep the default values as is for the rest of the fields and press <strong class="bold">Submit</strong>.<p>您的管道应该执行，画布应该如下所示:</p></li>
			</ol>
			<div><div><img src="img/B16777_06_020.jpg" alt="Figure 6.20 – Modified real-time inference pipeline&#13;&#10;" width="1454" height="1127"/>
				</div>
			</div>
			<p class="figure-caption">图 6.20–修改后的实时推理管道</p>
			<p>在确认管道可以没有任何问题地执行之后，您可以将它部署为实时端点。关于将托管实时端点的<a id="_idIndexMarker466"/>基础设施，您有两种选择。你可以部署在一个<strong class="bold"> Azure 容器实例</strong> ( <strong class="bold"> ACI </strong>)或者<strong class="bold"> Azure Kubernetes 服务</strong> ( <strong class="bold"> AKS </strong>)集群中。<strong class="bold"> ACI </strong>基础设施对于测试非常有用，而<strong class="bold"> AKS </strong>基础设施<a id="_idIndexMarker467"/>支持更好的生产环境。在我们的例子中，我们将部署到<strong class="bold"> ACI </strong>，这将在下一节中介绍。</p>
			<h1 id="_idParaDest-97"><a id="_idTextAnchor097"/>部署实时推理管道</h1>
			<p>在这个<a id="_idIndexMarker468"/>部分，您将部署您在<strong class="bold">实时推理管道</strong>设计器选项卡中创建的示例实时推理管道。让我们开始吧:</p>
			<ol>
				<li value="1">点击<strong class="bold">部署</strong>按钮。这将调出<strong class="bold">设置实时端点</strong>弹出窗口，如下图所示。</li>
				<li>在<strong class="bold">设置实时端点</strong>弹出框中，选择<strong class="bold">部署新实时端点</strong>单选按钮选项。</li>
				<li>在<strong class="bold">名称</strong>文本字段中，输入<strong class="bold">第一实时端点</strong>。</li>
				<li>在<strong class="bold">描述</strong>文本字段中，输入第一条实时管道的<strong class="bold">容器部署。</strong></li>
				<li>点击<strong class="bold">计算类型</strong>下拉列表，选择<strong class="bold"> Azure 容器实例</strong>。</li>
				<li>You won't<a id="_idIndexMarker469"/> need to modify the <strong class="bold">Advanced</strong> settings. The completed popup should look as follows:<div><img src="img/B16777_06_021.jpg" alt="Figure 6.21 – Set up real-time endpoint popup&#13;&#10;" width="919" height="649"/></div><p class="figure-caption">图 6.21–设置实时端点弹出窗口</p></li>
				<li>点击<strong class="bold"> Deploy </strong>按钮来配置您的实时端点。这将需要几分钟时间。</li>
			</ol>
			<p>在<a id="_idIndexMarker470"/>成功部署管道后，你会在 AzureML Studio 的<strong class="bold">资产</strong> | <strong class="bold">端点</strong>下找到新部署的管道。您刚刚部署的端点与您在第 5 章 、<em class="italic">中部署的端点相同，让机器进行模型训练</em>。可以通过 web 界面测试。你将在第 12 章 、<em class="italic">用代码</em>操作化模型中深入探究如何使用类似的端点。在继续之前，您应该删除实时端点以避免被计费。按照第五章 、<em class="italic">中<em class="italic">清理模型部署</em>部分的说明，让机器做模型训练</em>，删除您刚刚部署的端点。</p>
			<h1 id="_idParaDest-98"><a id="_idTextAnchor098"/>总结</h1>
			<p>本章介绍了管道设计器，它允许我们通过拖放来创建 AzureML 管道。您基于流失数据集和<strong class="bold">两级决策森林</strong>模型构建了您的第一个培训管道。我们讨论了三种管道类型，创建了培训管道，创建了批处理管道，并开发和部署了实时管道。</p>
			<p>本章总结了 AzureML 提供的无代码、低代码特性。在下一章，你将开始研究 AzureML Python SDK。AzureML Python SDK 允许你通过代码训练模型和创建机器学习管道，这对 DP-100 考试至关重要。</p>
			<h1 id="_idParaDest-99"><a id="_idTextAnchor099"/>问题</h1>
			<p>部署实时管道有哪些选择？</p>
			<ul>
				<li><strong class="bold">仅 Azure 容器实例</strong></li>
				<li><strong class="bold"> Azure 容器实例</strong>和<strong class="bold"> Azure Kubernetes 服务</strong></li>
				<li><strong class="bold"> Azure 容器实例</strong>和<strong class="bold"> Azure 虚拟机</strong></li>
				<li><strong class="bold">仅 Azure 虚拟机</strong></li>
			</ul>
			<h1 id="_idParaDest-100"><a id="_idTextAnchor100"/>延伸阅读</h1>
			<p>本节提供了一个有用的 web 资源列表，帮助您扩充 AzureML 设计器知识:</p>
			<ul>
				<li>在自动机器学习中配置数据拆分和交叉验证:<a href="https://docs.microsoft.com/azure/machine-learning/how-to-configure-cross-validation-data-splits%0D">https://docs . Microsoft . com/azure/machine-learning/how-to-configure-cross-validation-data-splits</a></li>
				<li>使用 AzureML 设计器运行批处理预测:<a href="https://github.com/MicrosoftDocs/azure-docs/blob/master/articles/machine-learning/how-to-run-batch-predictions-designer.md%0D">https://github . com/Microsoft docs/azure-docs/blob/master/articles/machine-learning/how-to-run-batch-predictions-designer . MD</a></li>
				<li>教程:设计师-部署机器学习模型:<a href="https://docs.microsoft.com/azure/machine-learning/tutorial-designer-automobile-price-deploy%0D">https://docs . Microsoft . com/azure/machine-learning/tutorial-Designer-automobile-price-deploy</a></li>
				<li>什么是 AzureML 设计器？<a href="https://docs.microsoft.com/azure/machine-learning/concept-designer%0D">https://docs . Microsoft . com/azure/机器学习/概念设计</a></li>
				<li>教程:设计师——训练无代码回归模型:<a href="https://docs.microsoft.com/azure/machine-learning/tutorial-designer-automobile-price-train-score%20">https://docs . Microsoft . com/azure/machine-learning/tutorial-Designer-automobile-price-train-score</a></li>
				<li>教程:设计师-部署机器学习模型:<a href="https://ttps://docs.microsoft.com/azure/machine-learning/tutorial-designer-automobile-price-deploy">ttps://docs . Microsoft . com/azure/machine-learning/tutorial-Designer-automobile-price-deploy</a></li>
			</ul>
		</div>
	</div>
</body></html>